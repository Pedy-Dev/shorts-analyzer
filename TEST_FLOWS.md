# í…ŒìŠ¤íŠ¸ í”Œë¡œìš° (Authentication Separation Verification)

ì´ ë¬¸ì„œëŠ” "ì‚¬ì´íŠ¸ ë¡œê·¸ì¸", "ë‚´ ì±„ë„ ë¶„ì„", "íƒ€ ì±„ë„ ë¶„ì„" ì„¸ ê°€ì§€ ì¸ì¦ ëª¨ë“œê°€ ì„œë¡œ ë…ë¦½ì ìœ¼ë¡œ ì‘ë™í•˜ëŠ”ì§€ ê²€ì¦í•˜ëŠ” í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ì…ë‹ˆë‹¤.

---

## í…ŒìŠ¤íŠ¸ í™˜ê²½ ì¤€ë¹„

### í•„ìš”í•œ ê²ƒë“¤
1. Google ê³„ì • 2ê°œ (ì˜ˆ: `ê³„ì •A - ì—¼ì¬ë¯¼`, `ê³„ì •B - ê²½ì œë‹ë³´ê¸°`)
2. YouTube Data API v3 í‚¤ (ì‚¬ìš©ì ì œê³µìš©)
3. ì„œë²„ í™˜ê²½ë³€ìˆ˜ `YOUTUBE_API_KEY_SERVER` ì„¤ì • í™•ì¸
4. Supabase users í…Œì´ë¸” ì ‘ê·¼ ê¶Œí•œ (DB í™•ì¸ìš©)

### ë¸Œë¼ìš°ì € ì„¤ì •
- ì‹œí¬ë¦¿ ëª¨ë“œ ì‚¬ìš© (ì¿ í‚¤ ê²©ë¦¬ í…ŒìŠ¤íŠ¸)
- DevTools ì—´ê¸° (Application â†’ Cookies, Console í™•ì¸)

---

## í…ŒìŠ¤íŠ¸ 1: ì‚¬ì´íŠ¸ ë¡œê·¸ì¸ í›„ íƒ­ ìœ ì§€ í™•ì¸

**ëª©ì **: ë¡œê·¸ì¸ í›„ ê¸°ì¡´ì— ìˆë˜ íƒ­ìœ¼ë¡œ ëŒì•„ê°€ëŠ”ì§€ í™•ì¸ (ë¬´ì¡°ê±´ "ë‚´ ì±„ë„ ë¶„ì„"ìœ¼ë¡œ ê°€ì§€ ì•ŠëŠ”ì§€)

### ì ˆì°¨
1. ë¸Œë¼ìš°ì €ì—ì„œ `http://localhost:3000` ì ‘ì† (ë¹„ë¡œê·¸ì¸ ìƒíƒœ)
2. "íƒ€ ì±„ë„ ë¶„ì„" íƒ­ì— ë¨¸ë¬´ë¥´ê¸°
3. ì±„ë„ URL ì…ë ¥ ì‹œë„ â†’ "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤" ì•Œë¦¼ í™•ì¸
4. ìƒë‹¨ "ë¡œê·¸ì¸" ë²„íŠ¼ í´ë¦­
5. Google ë¡œê·¸ì¸ (ê³„ì •A - ì—¼ì¬ë¯¼)
6. ë¦¬ë‹¤ì´ë ‰íŠ¸ í›„ **í˜„ì¬ íƒ­ í™•ì¸**

### ì˜ˆìƒ ê²°ê³¼
- âœ… "íƒ€ ì±„ë„ ë¶„ì„" íƒ­ ê·¸ëŒ€ë¡œ ìœ ì§€
- âŒ "ë‚´ ì±„ë„ ë¶„ì„" íƒ­ìœ¼ë¡œ ê°•ì œ ì´ë™í•˜ì§€ ì•ŠìŒ

### ì‹¤íŒ¨ ì‹œ ì²´í¬ í¬ì¸íŠ¸
- `MyChannelTab.tsx`ì˜ `proceedWithLogin()`ì— `localStorage.setItem('return_tab', 'myChannel')` ë‚¨ì•„ìˆëŠ”ì§€ í™•ì¸
- `app/page.tsx`ì˜ `useEffect`ì—ì„œ `returnTab` ì²˜ë¦¬ ë¡œì§ í™•ì¸

---

## í…ŒìŠ¤íŠ¸ 2: ë‚´ ì±„ë„ ì—°ê²° í›„ DB ì €ì¥ ë° ìë™ ë¡œë“œ

**ëª©ì **: YouTube ì±„ë„ ì—°ê²° ì‹œ DBì— ì €ì¥ë˜ê³ , ì¬ë°©ë¬¸ ì‹œ ìë™ìœ¼ë¡œ ë¶ˆëŸ¬ì™€ì§€ëŠ”ì§€ í™•ì¸

### ì ˆì°¨ (Part A: ì—°ê²° ë° ì €ì¥)
1. ë¡œê·¸ì¸ ìƒíƒœ (ê³„ì •A - ì—¼ì¬ë¯¼)
2. "ë‚´ ì±„ë„ ë¶„ì„" íƒ­ í´ë¦­
3. "ë‚´ ì±„ë„ ì—°ê²°í•˜ê¸°" ë²„íŠ¼ í´ë¦­
4. Google OAuth ì§„í–‰ (YouTube ê¶Œí•œ ìŠ¹ì¸)
5. ë¦¬ë‹¤ì´ë ‰íŠ¸ í›„ **"ë‚´ ì±„ë„ ë¶„ì„" íƒ­ìœ¼ë¡œ ìë™ ì´ë™** í™•ì¸
6. í™”ë©´ì— "ì´ë¯¸ ì—°ê²°ëœ ì±„ë„: [ì±„ë„ëª…]" í‘œì‹œ í™•ì¸

### ì ˆì°¨ (Part B: DB í™•ì¸)
7. Supabase Dashboard â†’ `users` í…Œì´ë¸” ì—´ê¸°
8. í•´ë‹¹ ì‚¬ìš©ì(ì—¼ì¬ë¯¼) ë ˆì½”ë“œ í™•ì¸:
   - `youtube_channel_id` ê°’ ì¡´ì¬
   - `youtube_channel_title` ê°’ ì¡´ì¬
   - `youtube_access_token` ê°’ ì¡´ì¬
   - `youtube_refresh_token` ê°’ ì¡´ì¬
   - `youtube_token_updated_at` ìµœì‹  ì‹œê°„

### ì ˆì°¨ (Part C: ì¬ë°©ë¬¸ ìë™ ë¡œë“œ)
9. ë¸Œë¼ìš°ì € ìƒˆë¡œê³ ì¹¨ (F5)
10. "ë‚´ ì±„ë„ ë¶„ì„" íƒ­ í´ë¦­
11. **"ë‚´ ì±„ë„ ì—°ê²°í•˜ê¸°" ë²„íŠ¼ ì—†ì´** ë°”ë¡œ ì±„ë„ ì •ë³´ í‘œì‹œ í™•ì¸

### ì˜ˆìƒ ê²°ê³¼
- âœ… DBì— YouTube ì±„ë„ ì •ë³´ ì €ì¥
- âœ… ì¬ë°©ë¬¸ ì‹œ `/api/user/me` í˜¸ì¶œë¡œ ìë™ ë¡œë“œ
- âœ… "ë‚´ ì±„ë„ ì—°ê²°í•˜ê¸°" ë²„íŠ¼ ë‹¤ì‹œ ì•ˆ ë‚˜íƒ€ë‚¨

### ì‹¤íŒ¨ ì‹œ ì²´í¬ í¬ì¸íŠ¸
- `/api/auth/callback` routeì˜ `state === 'youtube'` ë¸”ë¡ í™•ì¸ (ë¼ì¸ 119-161)
- `/api/user/me`ì˜ SELECT ì¿¼ë¦¬ì— YouTube í•„ë“œ í¬í•¨ ì—¬ë¶€ (ë¼ì¸ 26)
- `MyChannelTab.tsx`ì˜ `checkYoutubeConnection()` í•¨ìˆ˜ (ë¼ì¸ 37-54)

---

## í…ŒìŠ¤íŠ¸ 3: íƒ€ ì±„ë„ ë¶„ì„ì´ ë¡œê·¸ì¸ ê³„ì •ì„ ë°”ê¾¸ì§€ ì•ŠëŠ”ì§€ í™•ì¸ â­ï¸â­ï¸â­ï¸

**ëª©ì **: "íƒ€ ì±„ë„ ë¶„ì„"ì„ ì—¬ëŸ¬ ë²ˆ í•´ë„ ì‚¬ì´íŠ¸ ë¡œê·¸ì¸ ê³„ì •ì´ ì ˆëŒ€ ë°”ë€Œì§€ ì•ŠëŠ”ì§€ í™•ì¸

**ì´ê²ƒì´ ê°€ì¥ ì¤‘ìš”í•œ í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤!**

### ì ˆì°¨
1. ë¡œê·¸ì¸ ìƒíƒœ (ê³„ì •A - ì—¼ì¬ë¯¼)
2. ìš°ì¸¡ ìƒë‹¨ UserMenuì—ì„œ **í˜„ì¬ ë¡œê·¸ì¸ ê³„ì • í™•ì¸** (í”„ë¡œí•„ ì‚¬ì§„, ì´ë¦„)
3. "íƒ€ ì±„ë„ ë¶„ì„" íƒ­ í´ë¦­
4. YouTube API í‚¤ ì…ë ¥ (localStorageì— ì €ì¥)
5. ë‹¤ë¥¸ ì±„ë„ URL ì…ë ¥ (ì˜ˆ: `https://www.youtube.com/@ê²½ì œë‹ë³´ê¸°`)
   - âš ï¸ ì´ ì±„ë„ì€ ê³„ì •Aì™€ ë¬´ê´€í•œ **ì™„ì „íˆ ë‹¤ë¥¸ ì±„ë„**
6. "ì‡¼ì¸  ë¶„ì„ ì‹œì‘" ë²„íŠ¼ í´ë¦­
7. ë¶„ì„ ì§„í–‰ ì¤‘ ë° ì™„ë£Œ í›„ **ìš°ì¸¡ ìƒë‹¨ UserMenu í™•ì¸**
8. ì—¬ëŸ¬ ì±„ë„ì„ ì—°ì†ìœ¼ë¡œ ë¶„ì„ (3-5ê°œ)

### ì˜ˆìƒ ê²°ê³¼ (ê° ë‹¨ê³„ë§ˆë‹¤ í™•ì¸)
- âœ… ìš°ì¸¡ ìƒë‹¨ ê³„ì •ì´ ê³„ì† "ì—¼ì¬ë¯¼" ìœ ì§€
- âœ… DevTools â†’ Application â†’ Cookies â†’ `user_id` ê°’ ë³€ê²½ ì—†ìŒ
- âœ… Consoleì—ì„œ `/api/user/me` ì‘ë‹µ í™•ì¸ ì‹œ ë™ì¼í•œ user ID

### ì‹¤íŒ¨ ì‹œ ì¦ìƒ
- âŒ ë¶„ì„ í›„ ìš°ì¸¡ ìƒë‹¨ì´ "ê²½ì œë‹ë³´ê¸°"ë¡œ ë°”ë€œ
- âŒ `user_id` ì¿ í‚¤ê°€ ë³€ê²½ë¨
- âŒ `/api/user/me` ì‘ë‹µì´ ë‹¤ë¥¸ ì‚¬ìš©ì ì •ë³´ ë°˜í™˜

### ì‹¤íŒ¨ ì‹œ ì²´í¬ í¬ì¸íŠ¸ (ì½”ë“œ ê²€ì¦)
1. **`/api/get-channel-id/route.ts`**:
   - `request.cookies.get()` í˜¸ì¶œ ìˆëŠ”ì§€ ê²€ìƒ‰
   - `supabase` import ìˆëŠ”ì§€ ê²€ìƒ‰
   - `oauth2Client` ì‚¬ìš© ìˆëŠ”ì§€ ê²€ìƒ‰

2. **`/api/get-shorts/route.ts`**:
   - ë™ì¼í•˜ê²Œ cookies, supabase, oauth ê²€ìƒ‰

3. **`/api/subtitle/route.ts`**:
   - ë™ì¼í•˜ê²Œ cookies, supabase, oauth ê²€ìƒ‰

4. **`ChannelAnalysisTab.tsx`**:
   - `setUser()` í˜¸ì¶œ ìˆëŠ”ì§€ ê²€ìƒ‰
   - `setCurrentChannel()` í˜¸ì¶œ ìˆëŠ”ì§€ ê²€ìƒ‰ (ì´ê±´ MyChannelTab ì „ìš©)
   - localStorage ì¡°ì‘ ì¤‘ `user_id` ê´€ë ¨ ìˆëŠ”ì§€ í™•ì¸

### ë””ë²„ê¹… ë°©ë²•
```typescript
// /api/get-channel-id/route.ts ì²« ì¤„ì— ì¶”ê°€
export async function POST(request: NextRequest) {
  console.log('ğŸ” [DEBUG] Cookies:', request.cookies.getAll());
  console.log('ğŸ” [DEBUG] Headers:', Object.fromEntries(request.headers.entries()));
  // ...
}
```

---

## í…ŒìŠ¤íŠ¸ 4: ë¡œê·¸ì•„ì›ƒ í›„ íƒ€ ì±„ë„ ë¶„ì„ (ë¹„ë¡œê·¸ì¸ ìƒíƒœ)

**ëª©ì **: ë¡œê·¸ì¸ ì—†ì´ë„ íƒ€ ì±„ë„ ë¶„ì„ì´ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸

### ì ˆì°¨
1. ë¡œê·¸ì•„ì›ƒ (UserMenu â†’ ë¡œê·¸ì•„ì›ƒ)
2. "íƒ€ ì±„ë„ ë¶„ì„" íƒ­ í´ë¦­
3. YouTube API í‚¤ ì…ë ¥
4. ì±„ë„ URL ì…ë ¥ ë° ë¶„ì„ ì‹œì‘

### ì˜ˆìƒ ê²°ê³¼
- âœ… ë¡œê·¸ì¸ ì—†ì´ë„ ë¶„ì„ ê°€ëŠ¥
- âœ… API í‚¤ë§Œìœ¼ë¡œ YouTube Data API í˜¸ì¶œ ì„±ê³µ

### ì‹¤íŒ¨ ì‹œ ì²´í¬ í¬ì¸íŠ¸
- `ChannelAnalysisTab.tsx`ì˜ `isLoggedIn` ì²´í¬ ë¡œì§ (ë¼ì¸ 99-103)
- í˜„ì¬ëŠ” ë¡œê·¸ì¸ í•„ìˆ˜ë¡œ ë˜ì–´ ìˆìŒ â†’ ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ ë³€ê²½ ê°€ëŠ¥

---

## í…ŒìŠ¤íŠ¸ 5: API í‚¤ í´ë°± ë¡œì§ (ì„œë²„ í‚¤ â†’ ìœ ì € í‚¤)

**ëª©ì **: ì„œë²„ API í‚¤ í• ë‹¹ëŸ‰ ì´ˆê³¼ ì‹œ ìœ ì € API í‚¤ë¡œ ìë™ ì „í™˜ë˜ëŠ”ì§€ í™•ì¸

### ì ˆì°¨
1. `.env.local`ì—ì„œ `YOUTUBE_API_KEY_SERVER`ë¥¼ ì¼ë¶€ëŸ¬ ì˜ëª»ëœ ê°’ìœ¼ë¡œ ë³€ê²½
2. ì„œë²„ ì¬ì‹œì‘ (`npm run dev` ì¬ì‹¤í–‰)
3. íƒ€ ì±„ë„ ë¶„ì„ ì‹œë„ (ìœ ì € API í‚¤ëŠ” ì •ìƒ)

### ì˜ˆìƒ ê²°ê³¼
- âœ… Consoleì— "âš ï¸ ì„œë²„ API í‚¤ í• ë‹¹ëŸ‰ ì´ˆê³¼, ìœ ì € API í‚¤ë¡œ ì „í™˜..." ë¡œê·¸
- âœ… ë¶„ì„ì€ ì„±ê³µ (ìœ ì € API í‚¤ë¡œ ì§„í–‰)

### ê²€ì¦ ì½”ë“œ ìœ„ì¹˜
- `/api/get-channel-id/route.ts` ë¼ì¸ 74-104
- `/api/get-shorts/route.ts` ë¼ì¸ 211-226

---

## í…ŒìŠ¤íŠ¸ 6: ë©€í‹° ê³„ì • ì‹œë‚˜ë¦¬ì˜¤ (ì‹¤ì „ ì‹œë®¬ë ˆì´ì…˜)

**ëª©ì **: ì—¬ëŸ¬ ì‚¬ìš©ìê°€ ë™ì‹œì— ì‚¬ìš©í•˜ëŠ” ìƒí™© ì¬í˜„

### ì ˆì°¨
1. **ë¸Œë¼ìš°ì € A (ì‹œí¬ë¦¿ ëª¨ë“œ)**: ê³„ì •A(ì—¼ì¬ë¯¼) ë¡œê·¸ì¸
   - ë‚´ ì±„ë„ ë¶„ì„: ê³„ì •Aì˜ YouTube ì±„ë„ ì—°ê²°
   - íƒ€ ì±„ë„ ë¶„ì„: ë‹¤ë¥¸ ì±„ë„ 3ê°œ ë¶„ì„

2. **ë¸Œë¼ìš°ì € B (ì¼ë°˜ ëª¨ë“œ)**: ê³„ì •B(ê²½ì œë‹ë³´ê¸°) ë¡œê·¸ì¸
   - ë‚´ ì±„ë„ ë¶„ì„: ê³„ì •Bì˜ YouTube ì±„ë„ ì—°ê²°
   - íƒ€ ì±„ë„ ë¶„ì„: ë‹¤ë¥¸ ì±„ë„ 3ê°œ ë¶„ì„

3. **ë™ì‹œì— ì§„í–‰** (ë‘ ë¸Œë¼ìš°ì € ë²ˆê°ˆì•„ê°€ë©°)
   - Aì—ì„œ íƒ€ ì±„ë„ ë¶„ì„ â†’ Bì—ì„œ íƒ€ ì±„ë„ ë¶„ì„ â†’ Aì—ì„œ ë‚´ ì±„ë„ ë¶„ì„ â†’ ...

### ì˜ˆìƒ ê²°ê³¼
- âœ… ê° ë¸Œë¼ìš°ì €ì˜ ë¡œê·¸ì¸ ê³„ì • ìœ ì§€
- âœ… Aì˜ ë‚´ ì±„ë„ â‰  Bì˜ ë‚´ ì±„ë„
- âœ… Supabase DBì— ë‘ ì‚¬ìš©ìì˜ YouTube ì±„ë„ ì •ë³´ ë…ë¦½ì ìœ¼ë¡œ ì €ì¥

---

## íšŒê·€ í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

ë§¤ë²ˆ ì½”ë“œ ìˆ˜ì • í›„ ì•„ë˜ í•­ëª©ë“¤ì„ ë¹ ë¥´ê²Œ í™•ì¸:

- [ ] ë¡œê·¸ì¸ í›„ ê¸°ì¡´ íƒ­ ìœ ì§€ë¨
- [ ] ë‚´ ì±„ë„ ì—°ê²° í›„ DBì— ì €ì¥ë¨
- [ ] ì¬ë°©ë¬¸ ì‹œ ë‚´ ì±„ë„ ìë™ ë¡œë“œë¨
- [ ] íƒ€ ì±„ë„ ë¶„ì„ ì‹œ ë¡œê·¸ì¸ ê³„ì • ì•ˆ ë°”ë€œ
- [ ] íƒ€ ì±„ë„ ë¶„ì„ APIê°€ ì¿ í‚¤/Supabase ì•ˆ ì”€
- [ ] ì„œë²„ API í‚¤ í´ë°± ì‘ë™í•¨

---

## ë²„ê·¸ ë°œê²¬ ì‹œ ë³´ê³  í…œí”Œë¦¿

```markdown
## ë²„ê·¸ ë¦¬í¬íŠ¸

**ì¦ìƒ**: (ì˜ˆ: íƒ€ ì±„ë„ ë¶„ì„ í›„ ë¡œê·¸ì¸ ê³„ì •ì´ ë°”ë€œ)

**ì¬í˜„ ì ˆì°¨**:
1. ...
2. ...

**ì˜ˆìƒ ë™ì‘**:
- ...

**ì‹¤ì œ ë™ì‘**:
- ...

**DevTools ë¡œê·¸**:
```
(Console ì¶œë ¥ ë¶™ì—¬ë„£ê¸°)
```

**ê´€ë ¨ íŒŒì¼**:
- `app/api/.../route.ts`
- `app/components/...tsx`
```

---

## ìë™í™” ìŠ¤í¬ë¦½íŠ¸ (ì„ íƒì‚¬í•­)

ì¶”í›„ Playwrightë‚˜ Cypressë¡œ ìë™í™” ê°€ëŠ¥í•œ ì‹œë‚˜ë¦¬ì˜¤:

```typescript
// Example: Playwright test for Test 3
test('íƒ€ ì±„ë„ ë¶„ì„ì´ ë¡œê·¸ì¸ ê³„ì •ì„ ë°”ê¾¸ì§€ ì•ŠìŒ', async ({ page }) => {
  await page.goto('http://localhost:3000');

  // ë¡œê·¸ì¸
  await page.click('text=ë¡œê·¸ì¸');
  // ... Google OAuth í”Œë¡œìš°

  const userNameBefore = await page.textContent('[data-testid="user-name"]');

  // íƒ€ ì±„ë„ ë¶„ì„
  await page.click('text=íƒ€ ì±„ë„ ë¶„ì„');
  await page.fill('[data-testid="channel-url"]', 'https://youtube.com/@test');
  await page.click('text=ì‡¼ì¸  ë¶„ì„ ì‹œì‘');

  await page.waitForSelector('[data-testid="analysis-result"]');

  const userNameAfter = await page.textContent('[data-testid="user-name"]');

  expect(userNameAfter).toBe(userNameBefore);
});
```

---

**ì‘ì„±ì¼**: 2025-11-18
**ì‘ì„±ì**: Claude Code
**ë²„ì „**: 1.0
